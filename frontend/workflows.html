<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workflows | ACTION Platform</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>

  <!-- HEADER -->
  <header class="site-header scrolled">
    <div class="container nav-wrap">
      <a href="/" class="brand" aria-label="ACTION Home">
        <span class="brand-text">A C T I O N</span>
      </a>
      <nav class="nav-links" aria-label="Primary navigation">
        <a href="/workflows.html" class="active">Workflows</a>
      </nav>
      <a class="btn btn-secondary btn-sm" href="/">Home</a>
    </div>
  </header>

  <main>
    <!-- PAGE HEADER -->
    <section class="section page-hero">
      <div class="container">
        <div class="page-hero-inner fade-up visible">
          <p class="eyebrow">Workflow Studio</p>
          <h1>Clinical Trial <span class="highlight">Workflows</span></h1>
          <p class="lead">Create, manage, and orchestrate end-to-end clinical trial workflows through three stages: Screening, Cohort Formation, and Monitoring.</p>
        </div>
      </div>
    </section>

    <!-- CREATE WORKFLOW -->
    <section class="section" style="padding-top: 0;">
      <div class="container">
        <div class="panel fade-up visible" id="create-panel">
          <div class="panel-header">
            <div class="panel-icon blue">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </div>
            <div>
              <h2 class="panel-title">Create New Workflow</h2>
              <p class="panel-subtitle">Define a new clinical trial workflow to begin the pipeline.</p>
            </div>
          </div>

          <!-- Active workflow warning â€” shown by JS when a workflow is already in progress -->
          <div id="active-workflow-banner" class="active-workflow-banner" style="display:none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <div>
              <strong>A workflow is already in progress.</strong>
              <span id="active-workflow-info"></span>
              <br/>Please complete or delete the active workflow before creating a new one.
            </div>
          </div>

          <form id="create-workflow-form" class="form-grid">
            <div class="form-group">
              <label for="wf-name">Workflow Name</label>
              <input type="text" id="wf-name" placeholder="e.g. Phase-III Prostate Cancer Trial" required />
            </div>
            <div class="form-group">
              <label for="wf-trial">Trial Name</label>
              <input type="text" id="wf-trial" placeholder="e.g. PROSTATE-CANCER" required />
            </div>
            <div class="form-group full-width">
              <label for="wf-desc">Description <span class="optional">(optional)</span></label>
              <textarea id="wf-desc" rows="2" placeholder="Multi-site RCT for novel androgen-deprivation therapy..."></textarea>
            </div>
            <div class="form-actions full-width">
              <button type="submit" class="btn btn-primary" id="create-workflow-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Create Workflow
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- WORKFLOW LIST -->
    <section class="section" style="padding-top: 0;">
      <div class="container">
        <div class="panel fade-up visible" id="workflows-panel">
          <div class="panel-header">
            <div class="panel-icon green">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            </div>
            <div>
              <h2 class="panel-title">All Workflows</h2>
              <p class="panel-subtitle" id="wf-count">Loading...</p>
            </div>
            <button class="btn btn-secondary btn-sm" onclick="loadWorkflows()" style="margin-left:auto;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
              Refresh
            </button>
          </div>

          <!-- Empty state -->
          <div id="wf-empty" class="empty-state" style="display:none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-3)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <p>No workflows yet. Create one above to get started.</p>
          </div>

          <!-- Loading spinner -->
          <div id="wf-loading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading workflows...</p>
          </div>

          <!-- Workflow cards container -->
          <div id="wf-list" class="workflow-card-list"></div>
        </div>
      </div>
    </section>

    <!-- WORKFLOW DETAIL MODAL -->
    <div id="wf-modal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)closeModal()">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Workflow Detail</h2>
          <button class="btn-icon" onclick="closeModal()" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div id="modal-body" class="modal-body">
          <!-- Populated by JS -->
        </div>
        <div id="modal-actions" class="modal-actions">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>
  </main>

  <!-- TOAST -->
  <div id="toast-container" class="toast-container"></div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container footer-wrap">
      <p>Built for The MedGemma Impact Challenge &copy; <span id="year"></span></p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script src="/app.js"></script>
  <script src="/workflows.js"></script>
</body>
</html>
